---
- name: Register the agent with Wazuh manager # noqa 301 # TODO see how to detect if agent is already added and if it creates any files to remove noqa
  command: agent-auth -m {{ wazuh_manager_ip }}
  args:
    chdir: "{{ '/Library/Ossec/bin/' if (ansible_system == 'Darwin') else '/var/ossec/bin/' }}"

- name: Enable communication with Wazuh manager
  lineinfile:
    path: "{{ wazuh_conf_file }}"
    regex: "\\<address\\>"
    line: "      <address>{{ wazuh_manager_ip }}</address>"
