---
- name: Ensure vim-plug is installed
  include_tasks: plugins/install-Linux.yml

- name: Ensure vimrc is setup
  become_user: "{{ user.username }}"
  template:
    src: vimrc.j2
    dest: "~/.vimrc"
    mode: 0700

- name: Ensure plugins are installed # noqa 301
  become_user: "{{ user.username }}"
  command: "vim +PlugUpdate +qa"
  when: install_vimplug

- name: Ensure plugins are setup # noqa 305 503
  become_user: "{{ user.username }}"
  shell: "{{ item.command }}"
  loop: "{{ vim_plugins }}"
  when:
    - item.command is defined
    - install_vimplug

- name: Ensure settings are added to ~/.vimrc where available
  become_user: "{{ user.username }}"
  blockinfile:
    path: "~/.vimrc"
    block: |
      {{ item.settings }}
    marker: "{mark}"
    marker_begin: '" Settings for plugin {{ item.source }}'
    marker_end: ""
  loop: "{{ vim_plugins }}"
  when: item.settings is defined
