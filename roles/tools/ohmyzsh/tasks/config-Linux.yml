---
- name: Ensure .zshrc is copied to the User's home directory
  copy:
    src: ~/.zshrc
    dest: "/Users/{{ user.username }}"
    mode: 0644
    owner: "{{ user.username }}"
    group: "{{ user.groupname | default(omit) }}"
    remote_src: true

- name: Ensure plugins are configured
  become_user: "{{ user.username }}"
  blockinfile:
    path: ~/.zshrc
    marker: "#{mark} ANSIBLE MANAGED BLOCK for ohmyzsh"
    insertafter: '^plugins=\('
    block: |
      plugins=(
      {% for item in omz_plugins %}
        {{ item }}
      {% endfor %}
      )
    backup: true

- name: Ensure Theme is configured
  become_user: "{{ user.username }}"
  lineinfile:
    path: ~/.zshrc
    regexp: "^ZSH_THEME="
    line: '{{ ''ZSH_THEME="'' + omz_theme + ''"'' }}'
    backup: true
